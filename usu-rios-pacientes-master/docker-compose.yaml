version: '3.8' # Você pode remover esta linha se receber o aviso de obsoleto

services:
  # --- BANCOS DE DADOS ---
  marketplace-db:
    # ... (definição existente)
  social-midia-db:
    # ... (definição existente)
  teleconsulta-db:
    # ... (definição existente)
  users-isaude-db:
    # ... (definição existente)

  # --- REDIS (para API de Usuários) ---
  users-isaude-redis:
    # ... (definição existente)

  # --- API de Usuários/Pacientes ---
  users-api: # Nome do serviço dentro do Docker
    build: ./usu-rios-pacientes-master # Caminho para o diretório da API
    container_name: users-isaude-back-end # Nome do container
    restart: unless-stopped
    env_file:
      - ./usu-rios-pacientes-master/.env # Aponta para o arquivo .env da API
    ports:
      - "8081:80" # Mapeia a porta 80 do container para a porta 8081 na sua máquina
    volumes:
      # Monta o código-fonte para permitir hot-reload com 'npm run dev'
      - ./usu-rios-pacientes-master:/src
      # Evita que node_modules local seja montado sobre o do container
      - /src/node_modules
    depends_on:
      - users-isaude-db # Garante que o DB inicie antes
      - users-isaude-redis # Garante que o Redis inicie antes
    command: npm run dev # Comando para iniciar a API (conforme package.json)

# Define os volumes nomeados para persistência
volumes:
  # ... (definições existentes)

# (Opcional, mas recomendado) Define uma rede customizada
# networks:
#   isaude-network:
#     driver: bridge